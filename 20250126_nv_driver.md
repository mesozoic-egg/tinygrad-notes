# How Tinygrad's Nvidia driver works, and how it hacked p2p on 4090

There are three components that work together to drive a GPU in machine learning. The high level part is the python
or C++ code that does things like matrix multiplication and backpropagation. Then, they hand over control to the next
componet, the binding code. Such binding often exists in the form of a library that you import. One common way they
work is issue linux "ioctl" signals to the operating system, which then pass on the last component, the actual kernel
driver. Kernel driver do not run in userspace, and they deliver actual instructions to the GPU hardware. 

When some code does matrix multiplication, they would commonly call `cudaMalloc` first. The imported function `cudaMalloc`
is the binding layer. It sends some ioctl signals to the OS, and the instruction is delivered to the GPU by a kernel
driver. If we can figure out what these ioctl signals are, then we can write our own "userspace driver" and remove
the entire userspace dependency offered by vendor. Turns out, P2P functionality on 4090 was removed by blocking the
relevant ioctl signals!

## From high level CUDA to low level driver

We start off with a high level CUDA example:

```c++

```
